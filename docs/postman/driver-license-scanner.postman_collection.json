{
  "info": {
    "name": "Driver License Scanner",
    "_postman_id": "0f3b1e8e-0000-4d5a-9000-000000000000",
    "description": "Import this collection into Postman and run the requests or use the Collection Runner.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrlWeb",
      "value": "http://localhost:3000"
    },
    {
      "key": "baseUrlApi",
      "value": "http://localhost:8080"
    },
    {
      "key": "baseUrlOcr",
      "value": "http://localhost:8000"
    }
  ],
  "item": [
    {
      "name": "Health Checks",
      "item": [
        {
          "name": "Web - Root",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrlWeb}}/",
              "host": [
                "{{baseUrlWeb}}"
              ],
              "path": [
                ""
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Basic smoke check: response body should not be empty",
                  "pm.test('Body is not empty', function () {",
                  "  pm.expect(pm.response.text().length).to.be.above(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "API - Actuator Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrlApi}}/actuator/health",
              "host": [
                "{{baseUrlApi}}"
              ],
              "path": [
                "actuator",
                "health"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Try to parse JSON safely and check for a health status",
                  "var body = null;",
                  "try { body = pm.response.json(); } catch (e) { body = null; }",
                  "if (body && body.status) {",
                  "  pm.test('Health status is UP or ok', function() {",
                  "    pm.expect(['UP','OK','ok','up']).to.include(String(body.status));",
                  "  });",
                  "} else {",
                  "  pm.test('Response contains JSON body with a status field', function() {",
                  "    pm.expect(body).to.not.equal(null);",
                  "  });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "OCR Worker - /health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrlOcr}}/health",
              "host": [
                "{{baseUrlOcr}}"
              ],
              "path": [
                "health"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var body = null;",
                  "try { body = pm.response.json(); } catch (e) { body = null; }",
                  "if (body && body.status) {",
                  "  pm.test('Worker health status is ok or UP', function() {",
                  "    pm.expect(['ok','OK','up','UP']).to.include(String(body.status));",
                  "  });",
                  "} else {",
                  "  pm.test('Response should contain JSON body', function() {",
                  "    pm.expect(body).to.not.equal(null);",
                  "  });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "API - /license/scan",
      "item": [
        {
          "name": "Valid image",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Request-Id",
                "value": "test-request-123",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "image",
                  "type": "file",
                  "src": "<REPLACE_WITH_PATH_TO_VALID_IMAGE.jpg>"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrlApi}}/license/scan",
              "host": [
                "{{baseUrlApi}}"
              ],
              "path": [
                "license",
                "scan"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () { pm.response.to.have.status(200); });",
                  "pm.test('Cache-Control is no-store', function () { pm.response.to.have.header('Cache-Control', 'no-store'); });",
                  "pm.test('Response has contract fields', function () {",
                  "  var json = pm.response.json();",
                  "  pm.expect(json).to.have.property('requestId');",
                  "  pm.expect(json).to.have.property('selectedEngine');",
                  "  pm.expect(json).to.have.property('attemptedEngines');",
                  "  pm.expect(json).to.have.property('ocrConfidence');",
                  "  pm.expect(json).to.have.property('fields');",
                  "  pm.expect(json).to.have.property('validation');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Missing file",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Request-Id",
                "value": "test-request-124",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": []
            },
            "url": {
              "raw": "{{baseUrlApi}}/license/scan",
              "host": [
                "{{baseUrlApi}}"
              ],
              "path": [
                "license",
                "scan"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () { pm.response.to.have.status(400); });",
                  "pm.test('Cache-Control is no-store', function () { pm.response.to.have.header('Cache-Control', 'no-store'); });",
                  "pm.test('Error code is INVALID_IMAGE', function () {",
                  "  var json = pm.response.json();",
                  "  pm.expect(json.error.code).to.eql('INVALID_IMAGE');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Invalid type",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Request-Id",
                "value": "test-request-125",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "image",
                  "type": "file",
                  "src": "<REPLACE_WITH_PATH_TO_INVALID_FILE.txt>"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrlApi}}/license/scan",
              "host": [
                "{{baseUrlApi}}"
              ],
              "path": [
                "license",
                "scan"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () { pm.response.to.have.status(400); });",
                  "pm.test('Error code is INVALID_IMAGE', function () {",
                  "  var json = pm.response.json();",
                  "  pm.expect(json.error.code).to.eql('INVALID_IMAGE');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Oversized file",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "X-Request-Id",
                "value": "test-request-126",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "image",
                  "type": "file",
                  "src": "<REPLACE_WITH_PATH_TO_LARGE_IMAGE.jpg>"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrlApi}}/license/scan",
              "host": [
                "{{baseUrlApi}}"
              ],
              "path": [
                "license",
                "scan"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () { pm.response.to.have.status(400); });",
                  "pm.test('Error code is INVALID_IMAGE', function () {",
                  "  var json = pm.response.json();",
                  "  pm.expect(json.error.code).to.eql('INVALID_IMAGE');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ]
}
